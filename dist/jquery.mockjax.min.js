((t,r)=>{"function"==typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],function(e){return r(e,t)}):"object"==typeof exports?module.exports=r:r(t.jQuery||t.$,t)})(this,function(v,l){var k=v.ajax,b=[],S=[],C=[],u=/=\?(&|$)/,c=(new Date).getTime(),n=500;function M(t,r){w.debug(t,["Checking mock data against request data",t,r]);var n=!0;if("function"==typeof t)return!!t(r);if("string"==typeof r){if("function"==typeof t.test)return t.test(r);if("object"!=typeof t)return t===r;r=(e=>{var t,r,n,o,a={},s=String(e).split(/&/);for(t=0,r=s.length;t<r;++t){n=s[t];try{n=(n=decodeURIComponent(n.replace(/\+/g," "))).split(/=/)}catch(e){continue}a[n[0]]?(a[n[0]].splice||(o=a[n[0]],a[n[0]]=[],a[n[0]].push(o)),a[n[0]].push(n[1])):a[n[0]]=n[1]}return w.debug(null,["Getting query params from string",e,a]),a})(r)}return v.each(t,function(e){if(void 0===r[e])return n=!1;n="object"==typeof r[e]&&null!==r[e]?(n=n&&Array.isArray(r[e])?Array.isArray(t[e])&&r[e].length===t[e].length:n)&&M(t[e],r[e]):t[e]&&"function"==typeof t[e].test?n&&t[e].test(r[e]):n&&t[e]===r[e]}),n}function s(e,t){return e[t]===v.mockjaxSettings[t]}function o(e){return"number"==typeof e&&0<=e}function i(e){if(Array.isArray(e)&&2===e.length){var t=e[0],r=e[1];if(o(t)&&o(r))return Math.floor(Math.random()*(r-t))+t}else if(o(e))return e;return n}function O(t,r,n){w.debug(t,["Sending fake XHR request",t,r,n]);o=this;var o,a=function(){return function(){this.status=t.status,this.statusText=t.statusText,this.readyState=1;function e(){var e;this.readyState=4,"json"===r.dataType&&"object"==typeof t.responseText?this.responseText=JSON.stringify(t.responseText):"xml"===r.dataType?"string"==typeof t.responseXML?(this.responseXML=(t=>{void 0===l.DOMParser&&l.ActiveXObject&&(l.DOMParser=function(){},DOMParser.prototype.parseFromString=function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t});try{var e=(new DOMParser).parseFromString(t,"text/xml");if(!v.isXMLDoc(e))throw new Error("Unable to parse XML");if(1===v("parsererror",e).length)throw new Error("Error: "+v(e).text());return e}catch(e){t=void 0===e.name?e:e.name+": "+e.message;v(document).trigger("xmlParseError",[t])}})(t.responseXML),this.responseText=t.responseXML):this.responseXML=t.responseXML:"object"==typeof t.responseText&&null!==t.responseText?(t.contentType="application/json",this.responseText=JSON.stringify(t.responseText)):this.responseText=t.responseText,Array.isArray(t.status)?(e=Math.floor(Math.random()*t.status.length),this.status=t.status[e]):"number"!=typeof t.status&&"string"!=typeof t.status||(this.status=t.status),"string"==typeof t.statusText&&(this.statusText=t.statusText),"function"==typeof(e=this.onload||this.onreadystatechange)?(t.isTimeout&&(this.status=-1),e.call(this,t.isTimeout?"timeout":void 0)):t.isTimeout&&(this.status=-1)}if("function"==typeof t.response){if(2===t.response.length)return void t.response(n,function(){e.call(o)});t.response(n)}e.call(o)}.apply(o)};t.proxy?(w.info(t,["Retrieving proxy file: "+t.proxy,t]),k({global:!1,url:t.proxy,type:t.proxyType,data:t.data,async:r.async,dataType:"script"===r.dataType?"text/plain":r.dataType,complete:function(e){t.responseXML=t.responseText=e.responseText,s(t,"status")&&(t.status=e.status),s(t,"statusText")&&(t.statusText=e.statusText),!1===r.async?a():this.responseTimer=setTimeout(a,i(t.responseTime))}})):!1===r.async?a():this.responseTimer=setTimeout(a,i(t.responseTime))}function A(e,t,r){if("GET"===(a=e).type.toUpperCase()?u.test(a.url)||(a.url+=(/\?/.test(a.url)?"&":"?")+(a.jsonp||"callback")+"=?"):a.data&&u.test(a.data)||(a.data=(a.data?a.data+"&":"")+(a.jsonp||"callback")+"=?"),e.dataType="json",e.data&&u.test(e.data)||u.test(e.url)){var n=e,o=t,a=r,s=a&&a.context||n,i="string"==typeof n.jsonpCallback&&n.jsonpCallback||"jsonp"+c++,a=(n.data&&(n.data=(n.data+"").replace(u,"="+i+"$1")),n.url=n.url.replace(u,"="+i+"$1"),l[i]=l[i]||function(){f(n,s,o),g(n,s),l[i]=void 0;try{delete l[i]}catch(e){}},n.jsonpCallback=i,/^(\w+:)?\/\/([^\/?#]+)/.exec(e.url)),a=a&&(a[1]&&a[1]!==location.protocol||a[2]!==location.host);if(e.dataType="script","GET"===e.type.toUpperCase()&&a)return((t,r,e)=>{w.debug(r,["Performing JSONP request",r,t,e]);var n=e&&e.context||t,o=v.Deferred?new v.Deferred:null;if(r.response&&"function"==typeof r.response)r.response(e);else if("object"==typeof r.responseText)v.globalEval("("+JSON.stringify(r.responseText)+")");else{if(r.proxy)return w.info(r,["Performing JSONP proxy request: "+r.proxy,r]),k({global:!1,url:r.proxy,type:r.proxyType,data:r.data,dataType:"script"===t.dataType?"text/plain":t.dataType,complete:function(e){v.globalEval("("+e.responseText+")"),p(t,r,n,o)}}),o;v.globalEval("("+("string"==typeof r.responseText?'"'+r.responseText+'"':r.responseText)+")")}return p(t,r,n,o),o})(e,t,r)||!0}return null}function p(e,t,r,n){var o;setTimeout(function(){if(f(e,r,t),g(e,r),n){try{o=JSON.parse(t.responseText)}catch(e){}n.resolveWith(r,[o||t.responseText]),w.log(t,["JSONP mock call complete",t,n])}},i(t.responseTime))}function f(e,t,r){e.success&&e.success.call(t,r.responseText||"","success",{}),e.global&&(e.context?v(e.context):v.event).trigger("ajaxSuccess",[{},e])}function g(e,t){e.complete&&e.complete.call(t,{statusText:"success",status:200},"success"),e.global&&(e.context?v(e.context):v.event).trigger("ajaxComplete",[{},e]),e.global&&!--v.active&&v.event.trigger("ajaxStop")}v.extend({ajax:function e(t,n){var r,o,a;w.debug(null,["Ajax call intercepted",t,n]),"object"==typeof t?(n=t,t=void 0):(n=n||{}).url=t||n.url,(o=v.ajaxSetup({},n)).type=o.method=o.method||o.type;for(var s=function(e,t){var r=n[e.toLowerCase()];return function(){"function"==typeof r&&r.apply(this,[].slice.call(arguments)),t["onAfter"+e]()}},i=0;i<b.length;i++){var l=v.mockjaxSettings.matchInRegistrationOrder?i:b.length-1-i;if(l=b[l]){if(a=((e,r)=>{if("function"==typeof e)return e(r);var t=e.namespace||void 0===e.namespace&&v.mockjaxSettings.namespace;if("function"==typeof e.url.test){if(t&&(t=t.replace(/(\/+)$/,""),n=e.url.source.replace(/^(\^+)/,"").replace(/^/,"^("+t+")?/?"),e.url=new RegExp(n)),!e.url.test(r.url))return null}else{var n=e.url,t=(n=t?[t.replace(/(\/+)$/,""),e.url.replace(/^(\/+)/,"")].join("/"):n).indexOf("*");if(n!==r.url&&-1===t||!new RegExp(n.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".+")).test(r.url))return null}if(e.requestHeaders){if(void 0===r.headers)return null;var o=!1;if(v.each(e.requestHeaders,function(e,t){if(r.headers[e]!==t)return!(o=!0)}),o)return null}return!(!e.data||r.data&&M(e.data,r.data))||e&&e.type&&e.type.toLowerCase()!==r.type.toLowerCase()?null:e})(l,o)){if(v.mockjaxSettings.retainAjaxCalls&&S.push(o),w.info(a,["MOCK "+o.type.toUpperCase()+": "+o.url,v.ajaxSetup({},o)]),(301===a.status||302===a.status)&&("GET"===o.type.toUpperCase()||"HEAD"===o.type.toUpperCase())&&a.headers.Location){w.debug("Doing mock redirect to",a.headers.Location,o.type);for(var u={},c=Object.keys(n),p=0;p<c.length;p++)u[c[p]]=n[c[p]];return u.url=a.headers.Location,u.headers={Referer:n.url},e(u)}if(!o.dataType||"JSONP"!==o.dataType.toUpperCase()||!(r=A(o,a,n))){n.crossDomain=!1,a.cache=o.cache,a.timeout=o.timeout,a.global=o.global,a.isTimeout&&(1<a.responseTime?n.timeout=a.responseTime-1:(a.responseTime=2,n.timeout=1)),"function"==typeof a.onAfterSuccess&&(n.success=s("Success",a)),"function"==typeof a.onAfterError&&(n.error=s("Error",a)),"function"==typeof a.onAfterComplete&&(n.complete=s("Complete",a)),j=T=h=m=y=x=d=g=f=void 0;var f=a,g=n;if(f.url instanceof RegExp&&f.hasOwnProperty("urlParams")){var d=f.url.exec(g.url);if(1!==d.length){d.shift();for(var x=0,y=d.length,m=f.urlParams.length,h=Math.min(y,m),T={};x<h;x++){var j=f.urlParams[x];T[j]=d[x]}g.urlParams=T}}((o,a,s,i)=>{r=k.call(v,v.extend(!0,{},s,{xhr:function(){return t=o,r=a,e=s,n=i,w.debug(t,["Creating new mock XHR object",t,r,e,n]),void 0===(t=v.extend(!0,{},v.mockjaxSettings,t)).headers&&(t.headers={}),void 0===r.headers&&(r.headers={}),t.contentType&&(t.headers["content-type"]=t.contentType),{status:t.status,statusText:t.statusText,readyState:1,open:function(){},send:function(){n.fired=!0,O.call(this,t,r,e)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(e,t){r.headers[e]=t},getResponseHeader:function(e){return t.headers&&t.headers[e]?t.headers[e]:"last-modified"===e.toLowerCase()?t.lastModified||(new Date).toString():"etag"===e.toLowerCase()?t.etag||"":"content-type"===e.toLowerCase()?t.contentType||"text/plain":void 0},getAllResponseHeaders:function(){var r="";return t.contentType&&(t.headers["content-type"]=t.contentType),v.each(t.headers,function(e,t){r+=e+": "+t+"\n"}),r}};var t,r,e,n}}))})(a,o,n,l)}return r}w.debug(l,["Mock does not match request",t,o])}}if(w.log(null,["No mock matched to request",t,n]),v.mockjaxSettings.retainAjaxCalls&&C.push(n),!0===v.mockjaxSettings.throwUnmocked)throw new Error("AJAX not mocked: "+n.url);return w.log("Real ajax call to",n.url),k.apply(v,[n])}});var w={_log:function(e,t,r){var n=v.mockjaxSettings.logging;if(e&&void 0!==e.logging&&(n=e.logging),r=0===r?r:r||a.LOG,t=t.splice?t:[t],!(!1===n||n<r))return v.mockjaxSettings.log?v.mockjaxSettings.log(e,t[1]||t[0]):v.mockjaxSettings.logger&&v.mockjaxSettings.logger[v.mockjaxSettings.logLevelMethods[r]]?v.mockjaxSettings.logger[v.mockjaxSettings.logLevelMethods[r]].apply(v.mockjaxSettings.logger,t):void 0},debug:function(e,t){return w._log(e,t,a.DEBUG)},log:function(e,t){return w._log(e,t,a.LOG)},info:function(e,t){return w._log(e,t,a.INFO)},warn:function(e,t){return w._log(e,t,a.WARN)},error:function(e,t){return w._log(e,t,a.ERROR)}},a={DEBUG:4,LOG:3,INFO:2,WARN:1,ERROR:0};return v.mockjaxSettings={log:null,logger:l.console,logging:2,logLevelMethods:["error","warn","info","log","debug"],matchInRegistrationOrder:!0,namespace:null,status:200,statusText:"OK",responseTime:n,isTimeout:!1,throwUnmocked:!1,retainAjaxCalls:!0,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}},v.mockjax=function(e){var t;return Array.isArray(e)?v.map(e,function(e){return v.mockjax(e)}):(t=b.length,b[t]=e,w.log(e,["Created new mock handler",e]),t)},v.mockjax._logger=w,v.mockjax.clear=function(e){"string"==typeof e||e instanceof RegExp?b=(t=>{for(var e,r=[],n=t instanceof RegExp?function(e){return t.test(e)}:function(e){return t===e},o=0,a=b.length;o<a;o++)n((e=b[o]).url)?w.log(e,["Clearing mock: "+(e&&e.url),e]):r.push(e);return r})(e):e||0===e?(w.log(b[e],["Clearing mock: "+(b[e]&&b[e].url),b[e]]),b[e]=null):(w.log(null,"Clearing all mocks"),b=[]),S=[],C=[]},v.mockjax.clearRetainedAjaxCalls=function(){S=[],C=[],w.debug(null,"Cleared retained ajax calls")},v.mockjax.handler=function(e){if(1===arguments.length)return b[e]},v.mockjax.handlers=function(){return b},v.mockjax.mockedAjaxCalls=function(){return S},v.mockjax.unfiredHandlers=function(){for(var e=[],t=0,r=b.length;t<r;t++){var n=b[t];null===n||n.fired||e.push(n)}return e},v.mockjax.unmockedAjaxCalls=function(){return C},v.mockjax});